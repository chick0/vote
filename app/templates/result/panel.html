{% extends 'layout.html' %}
{% block content %}
<section class="section">
    <div class="container">
        <div class="columns">
            <div class="column">
                <h1 class="title">투표 결과</h1>
                <p class="subtitle">{{ title }}</p>
        
                <div class="content is-large">
                    <p>* 투표에는 총 <b>{{ votes }}명</b>이 참여했습니다.</p>
                    <p>* 기권표는 총 <b>{{ drop }}개</b>가 있습니다.</p>
                </div>

                <table class="table is-fullwidth">
                    <thead>
                        <tr>
                            <th>선택지</th>
                            <th>받은 투표수</th>
                            <th>득표율</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for r in result %}
                    {% if r[1] == large_score %}
                        {% set class = "is-selected" %}
                    {% else %}
                        {% set class = "" %}
                    {% endif %}
                        <tr class="{{class}}">
                            <td>{{ r[0] }}</td>
                            <td>{{ r[1] }}</td>
                            <td>{{ r[2] }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <a class="button is-link is-large is-fullwidth" href="{{ url_for('restart.panel', vote_id=id) }}">다시 투표하기</a>
            </div>
            <div class="column">
                <canvas id="chart"></canvas>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='js/chart.min.js') }}"></script>
<script>
    const data = {
        labels: {{ labels|list|safe }},
        datasets: [{
            label: '투표 결과',
            backgroundColor: {{ colors|list|safe }},
            data: {{ data|list|safe }},
        }],
    };

    const chart = new Chart(
        document.getElementById('chart'),
        {
            type: 'doughnut',
            data: data,
            options: {},
        }
    );
</script>
{% endblock %}